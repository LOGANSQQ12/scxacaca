<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LogansHuck</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', system-ui, sans-serif;
            opacity: 0;
            animation: fadeIn 2.5s ease-out forwards;
            background-color: black;
        }
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            display: block;
        }
        .login-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 28px;
            padding: 40px 38px;
            width: 340px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
            transition: box-shadow 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }
        .login-container:hover {
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.9), 0 0 0 1px rgba(255, 255, 255, 0.15) inset;
        }
        .login-container h2 {
            margin: 0 0 28px 0;
            color: white;
            font-weight: 300;
            font-size: 2rem;
            letter-spacing: 2px;
            text-align: center;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }
        .input-group {
            margin-bottom: 22px;
            position: relative;
        }
        .input-group label {
            display: block;
            color: #ccc;
            font-size: 0.9rem;
            font-weight: 300;
            letter-spacing: 1px;
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        .input-group input {
            width: 100%;
            background: rgba(20, 20, 20, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px;
            padding: 14px 20px;
            font-size: 1rem;
            color: white;
            outline: none;
            box-sizing: border-box;
            transition: all 0.2s;
            font-weight: 300;
            backdrop-filter: blur(5px);
        }
        .input-group input:focus {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(30, 30, 30, 0.8);
            box-shadow: 0 0 15px rgba(255,255,255,0.1);
        }
        .input-group input::placeholder {
            color: rgba(255,255,255,0.3);
            font-weight: 300;
        }
        .availability {
            font-size: 0.8rem;
            margin-top: 5px;
            margin-left: 10px;
            color: #aaa;
            min-height: 20px;
        }
        .availability.available {
            color: #8bc34a;
        }
        .availability.taken {
            color: #ef5350;
        }
        button {
            width: 100%;
            background: transparent;
            border: 1.5px solid white;
            border-radius: 40px;
            padding: 14px;
            color: white;
            font-size: 1.2rem;
            font-weight: 400;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.25s;
            margin-top: 15px;
            backdrop-filter: blur(5px);
            background-color: rgba(255,255,255,0.02);
            text-transform: uppercase;
        }
        button:hover {
            background-color: white;
            color: black;
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
            border-color: transparent;
        }
        .tg-button {
            display: inline-block;
            width: 100%;
            background: transparent;
            border: 1.5px solid white;
            border-radius: 40px;
            padding: 12px 14px;
            color: white;
            font-size: 1rem;
            font-weight: 300;
            letter-spacing: 1px;
            text-align: center;
            text-decoration: none;
            transition: 0.25s;
            margin-top: 25px;
            backdrop-filter: blur(5px);
            background-color: rgba(255,255,255,0.02);
            text-transform: none;
            box-sizing: border-box;
        }
        .tg-button:hover {
            background-color: white;
            color: black;
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
            border-color: transparent;
        }
        .message {
            color: #aaf0e9;
            text-align: center;
            margin: 10px 0 0;
            font-size: 0.9rem;
            font-weight: 300;
            letter-spacing: 0.5px;
            min-height: 24px;
        }
        .switch-link {
            text-align: center;
            margin-top: 20px;
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.2s;
            text-decoration: underline;
        }
        .switch-link:hover {
            color: white;
        }
        .back-link {
            color: rgba(255,255,255,0.5);
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            text-decoration: underline;
            transition: 0.2s;
        }
        .back-link:hover {
            color: white;
        }
        .hidden {
            display: none;
        }

        @media screen and (max-width: 500px) {
            .login-container {
                width: 90%;
                padding: 30px 20px;
                border-radius: 24px;
            }
            .login-container h2 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }
            .input-group {
                margin-bottom: 18px;
            }
            .input-group input {
                padding: 12px 18px;
                font-size: 0.95rem;
            }
            button {
                padding: 12px;
                font-size: 1.1rem;
            }
            .tg-button {
                padding: 10px 12px;
                font-size: 0.95rem;
            }
        }
    </style>
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div class="login-container">
        <h2>LogansHuck</h2>

        <!-- Форма входа -->
        <div id="form-login">
            <div class="input-group">
                <label>Логин</label>
                <input type="text" id="login-username" placeholder="введите логин" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Пароль</label>
                <input type="password" id="login-password" placeholder="******" autocomplete="off">
            </div>
            <button id="login-btn">ВОЙТИ</button>
            <div id="login-message" class="message"></div>
            <div class="switch-link" id="go-to-register">зарегистрироваться</div>
        </div>

        <!-- Форма регистрации -->
        <div id="form-register" class="hidden">
            <div class="input-group">
                <label>Электронная почта</label>
                <input type="email" id="reg-email" placeholder="example@mail.com" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Логин</label>
                <input type="text" id="reg-username" placeholder="придумайте логин" autocomplete="off">
                <div id="username-availability" class="availability"></div>
            </div>
            <div class="input-group">
                <label>Пароль</label>
                <input type="password" id="reg-password" placeholder="******" autocomplete="off">
            </div>
            <div class="input-group">
                <label>Повторите пароль</label>
                <input type="password" id="reg-password2" placeholder="******" autocomplete="off">
            </div>
            <button id="register-btn">ЗАРЕГИСТРИРОВАТЬСЯ</button>
            <div id="register-message" class="message"></div>
            <div class="switch-link" id="go-to-login">уже есть аккаунт? войти</div>
        </div>

        <!-- Форма подтверждения кода (для регистрации) -->
        <div id="form-register-code" class="hidden">
            <div class="input-group">
                <label>Код подтверждения</label>
                <input type="text" id="reg-code" placeholder="введите код из письма" autocomplete="off">
            </div>
            <button id="verify-reg-code-btn">ПОДТВЕРДИТЬ РЕГИСТРАЦИЮ</button>
            <div id="reg-code-message" class="message"></div>
            <div class="back-link" id="back-to-register">← назад к регистрации</div>
        </div>

        <!-- Форма подтверждения кода (для входа) -->
        <div id="form-login-code" class="hidden">
            <div class="input-group">
                <label>Код подтверждения</label>
                <input type="text" id="login-code" placeholder="введите код из письма" autocomplete="off">
            </div>
            <button id="verify-login-code-btn">ПОДТВЕРДИТЬ ВХОД</button>
            <div id="login-code-message" class="message"></div>
            <div class="back-link" id="back-to-login">← назад</div>
        </div>

        <a href="https://t.me/xyitalogansa" class="tg-button" target="_blank">тгк разраба</a>
    </div>

    <!-- Three.js фон -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.126.0/build/three.module.js"
            }
        }
    </script>
    <script type="module">
        // --- Three.js (без изменений) ---
        import * as THREE from 'three';

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 15);
        camera.lookAt(0, 0, 0);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: false, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        const ambientLight = new THREE.AmbientLight(0x404060);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(1, 2, 5);
        scene.add(dirLight);
        const backLight = new THREE.PointLight(0x335588, 0.8);
        backLight.position.set(-3, 1, -5);
        scene.add(backLight);

        const triangleCount = 650;
        const positions = [];
        const baseSize = 0.4;
        for (let i = 0; i < triangleCount; i++) {
            const x = (Math.random() - 0.5) * 30;
            const y = (Math.random() - 0.5) * 20;
            const z = (Math.random() - 0.5) * 30 - 5;
            const angle1 = Math.random() * Math.PI * 2;
            const angle2 = angle1 + (Math.PI * 2 / 3);
            const angle3 = angle2 + (Math.PI * 2 / 3);
            const scale = baseSize * (0.6 + Math.random() * 0.8);
            const v1 = new THREE.Vector3(Math.cos(angle1) * scale, Math.sin(angle1) * scale, 0);
            const v2 = new THREE.Vector3(Math.cos(angle2) * scale, Math.sin(angle2) * scale, 0);
            const v3 = new THREE.Vector3(Math.cos(angle3) * scale, Math.sin(angle3) * scale, 0);
            const rotX = Math.random() * Math.PI;
            const rotY = Math.random() * Math.PI;
            const rotZ = Math.random() * Math.PI;
            v1.applyEuler(new THREE.Euler(rotX, rotY, rotZ));
            v2.applyEuler(new THREE.Euler(rotX, rotY, rotZ));
            v3.applyEuler(new THREE.Euler(rotX, rotY, rotZ));
            v1.x += x; v1.y += y; v1.z += z;
            v2.x += x; v2.y += y; v2.z += z;
            v3.x += x; v3.y += y; v3.z += z;
            const lineVertices = [v1, v2, v2, v3, v3, v1];
            lineVertices.forEach(v => positions.push(v.x, v.y, v.z));
        }
        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        const material = new THREE.LineBasicMaterial({ color: 0xffffff, opacity: 0.45, transparent: true });
        const trianglesMesh = new THREE.LineSegments(geometry, material);
        scene.add(trianglesMesh);

        const particleCount = 1800;
        const particleGeo = new THREE.BufferGeometry();
        const particlePositions = new Float32Array(particleCount * 3);
        const particleSpeeds = [];
        for (let i = 0; i < particleCount; i++) {
            particlePositions[i*3] = (Math.random() - 0.5) * 50;
            particlePositions[i*3+1] = (Math.random() - 0.5) * 40;
            particlePositions[i*3+2] = (Math.random() - 0.5) * 30 - 10;
            particleSpeeds.push({
                y: 0.005 + Math.random() * 0.015,
                resetY: 12 + Math.random() * 8,
            });
        }
        particleGeo.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
        const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 32;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#ffffff';
        ctx.beginPath(); ctx.arc(16, 16, 14, 0, 2 * Math.PI); ctx.fill();
        ctx.globalCompositeOperation = 'source-atop';
        ctx.filter = 'blur(3px)';
        ctx.fillStyle = 'rgba(255,255,255,0.8)';
        ctx.beginPath(); ctx.arc(16, 16, 14, 0, 2 * Math.PI); ctx.fill();
        const particleTexture = new THREE.CanvasTexture(canvas);
        const particleMaterial = new THREE.PointsMaterial({
            color: 0xffffff, map: particleTexture, size: 0.25,
            transparent: true, opacity: 0.4, blending: THREE.AdditiveBlending, depthWrite: false
        });
        const particles = new THREE.Points(particleGeo, particleMaterial);
        scene.add(particles);
        scene.fog = new THREE.FogExp2(0x050505, 0.025);

        let clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            const elapsedTime = performance.now() * 0.001;
            trianglesMesh.rotation.y += 0.0005;
            trianglesMesh.rotation.x += 0.0002;
            const positionsAttr = particles.geometry.attributes.position;
            const posArray = positionsAttr.array;
            for (let i = 0; i < particleCount; i++) {
                let yIdx = i*3 + 1;
                posArray[yIdx] -= particleSpeeds[i].y * 40 * delta;
                if (posArray[yIdx] < -15) {
                    posArray[yIdx] = particleSpeeds[i].resetY;
                    posArray[i*3] = (Math.random() - 0.5) * 50;
                    posArray[i*3+2] = (Math.random() - 0.5) * 30 - 10;
                }
            }
            positionsAttr.needsUpdate = true;
            camera.position.x = Math.sin(elapsedTime * 0.1) * 2;
            camera.position.z = 15 + Math.sin(elapsedTime * 0.2) * 1;
            camera.lookAt(0, 0, 0);
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- Логика приложения (регистрация с подтверждением по коду) ---
        // База подтверждённых пользователей
        const users = {};

        // Временное хранилище для данных регистрации перед подтверждением
        let pendingRegistration = null;
        let pendingCode = null;

        // Инициализация EmailJS (замените на свои данные)
        (function initEmailJS() {
            const USER_ID = 'YOUR_USER_ID'; // ЗАМЕНИТЕ
            if (USER_ID !== 'YOUR_USER_ID') {
                emailjs.init(USER_ID);
            } else {
                console.warn('EmailJS не настроен: используется имитация отправки кода');
            }
        })();

        // Элементы форм
        const loginForm = document.getElementById('form-login');
        const registerForm = document.getElementById('form-register');
        const loginCodeForm = document.getElementById('form-login-code');
        const registerCodeForm = document.getElementById('form-register-code');

        // Поля входа
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const loginMsg = document.getElementById('login-message');

        // Поля регистрации
        const regEmail = document.getElementById('reg-email');
        const regUsername = document.getElementById('reg-username');
        const regPassword = document.getElementById('reg-password');
        const regPassword2 = document.getElementById('reg-password2');
        const registerBtn = document.getElementById('register-btn');
        const registerMsg = document.getElementById('register-message');
        const usernameAvailability = document.getElementById('username-availability');

        // Поля для кода при регистрации
        const regCodeInput = document.getElementById('reg-code');
        const verifyRegCodeBtn = document.getElementById('verify-reg-code-btn');
        const regCodeMsg = document.getElementById('reg-code-message');
        const backToRegister = document.getElementById('back-to-register');

        // Поля для кода при входе
        const loginCodeInput = document.getElementById('login-code');
        const verifyLoginCodeBtn = document.getElementById('verify-login-code-btn');
        const loginCodeMsg = document.getElementById('login-code-message');
        const backToLogin = document.getElementById('back-to-login');

        // Ссылки переключения
        const goToRegister = document.getElementById('go-to-register');
        const goToLogin = document.getElementById('go-to-login');

        // Вспомогательные функции
        function isUsernameTaken(username) {
            return users.hasOwnProperty(username);
        }

        // Отправка кода через EmailJS (или имитация)
        async function sendCodeToEmail(email, code) {
            const SERVICE_ID = 'YOUR_SERVICE_ID';
            const TEMPLATE_ID = 'YOUR_TEMPLATE_ID';
            const USER_ID = 'YOUR_USER_ID';

            if (SERVICE_ID.includes('YOUR_') || TEMPLATE_ID.includes('YOUR_') || USER_ID.includes('YOUR_')) {
                console.log('EmailJS не настроен. Код:', code);
                alert(`[ДЕМО] Код подтверждения: ${code}`);
                return true;
            }

            try {
                await emailjs.send(SERVICE_ID, TEMPLATE_ID, { to_email: email, code }, USER_ID);
                return true;
            } catch (e) {
                console.error(e);
                return false;
            }
        }

        // Проверка доступности логина в реальном времени
        regUsername.addEventListener('input', () => {
            const username = regUsername.value.trim();
            if (username.length === 0) {
                usernameAvailability.textContent = '';
                usernameAvailability.className = 'availability';
                return;
            }
            if (isUsernameTaken(username)) {
                usernameAvailability.textContent = '❌ Логин занят';
                usernameAvailability.className = 'availability taken';
            } else {
                usernameAvailability.textContent = '✅ Логин свободен';
                usernameAvailability.className = 'availability available';
            }
        });

        // Переключение на регистрацию
        goToRegister.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            loginCodeForm.classList.add('hidden');
            registerCodeForm.classList.add('hidden');
            // Очистка сообщений
            loginMsg.textContent = '';
            registerMsg.textContent = '';
            regCodeMsg.textContent = '';
            usernameAvailability.textContent = '';
        });

        // Переключение на вход
        goToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            loginCodeForm.classList.add('hidden');
            registerCodeForm.classList.add('hidden');
            // Очистка
            registerMsg.textContent = '';
            loginMsg.textContent = '';
        });

        // Обработка регистрации (первый шаг)
        registerBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            const email = regEmail.value.trim();
            const username = regUsername.value.trim();
            const pass = regPassword.value.trim();
            const pass2 = regPassword2.value.trim();

            // Валидация
            if (!email || !username || !pass || !pass2) {
                registerMsg.textContent = 'Заполните все поля';
                return;
            }
            if (pass !== pass2) {
                registerMsg.textContent = 'Пароли не совпадают';
                return;
            }
            if (isUsernameTaken(username)) {
                registerMsg.textContent = 'Логин уже занят';
                return;
            }

            // Генерируем код
            const code = Math.floor(100000 + Math.random() * 900000).toString();
            pendingCode = code;
            pendingRegistration = { email, username, password: pass };

            // Отправляем код
            registerMsg.textContent = 'Отправка кода...';
            const sent = await sendCodeToEmail(email, code);
            if (sent) {
                // Переходим к форме ввода кода
                registerForm.classList.add('hidden');
                registerCodeForm.classList.remove('hidden');
                registerMsg.textContent = ''; // очищаем сообщение
                regCodeInput.value = '';
                regCodeMsg.textContent = `Код отправлен на ${email}`;
            } else {
                registerMsg.textContent = 'Ошибка отправки кода. Попробуйте позже.';
            }
        });

        // Подтверждение регистрации по коду
        verifyRegCodeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const enteredCode = regCodeInput.value.trim();
            if (!enteredCode) {
                regCodeMsg.textContent = 'Введите код';
                return;
            }
            if (!pendingRegistration || !pendingCode) {
                regCodeMsg.textContent = 'Ошибка: нет ожидающей регистрации';
                return;
            }
            if (enteredCode === pendingCode) {
                // Сохраняем пользователя
                const { username, email, password } = pendingRegistration;
                users[username] = { email, password };
                // Сбрасываем временные данные
                pendingRegistration = null;
                pendingCode = null;
                // Уведомление и переход на форму входа
                regCodeMsg.textContent = 'Регистрация успешна! Теперь войдите.';
                setTimeout(() => {
                    registerCodeForm.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                    regCodeMsg.textContent = '';
                    // Очищаем поля регистрации
                    regEmail.value = '';
                    regUsername.value = '';
                    regPassword.value = '';
                    regPassword2.value = '';
                    usernameAvailability.textContent = '';
                }, 1500);
            } else {
                regCodeMsg.textContent = 'Неверный код';
            }
        });

        // Назад из формы кода регистрации в форму регистрации
        backToRegister.addEventListener('click', (e) => {
            e.preventDefault();
            registerCodeForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            regCodeMsg.textContent = '';
            pendingRegistration = null;
            pendingCode = null;
        });

        // Обработка входа (первый шаг) — аналогично, но для входа
        let loginPending = null; // для хранения данных входа (username)

        loginBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();

            if (!username || !password) {
                loginMsg.textContent = 'Введите логин и пароль';
                return;
            }
            const user = users[username];
            if (!user || user.password !== password) {
                loginMsg.textContent = 'Неверный логин или пароль';
                return;
            }

            // Генерируем код для входа
            const code = Math.floor(100000 + Math.random() * 900000).toString();
            loginPending = { username, code };

            // Отправляем код на почту пользователя
            loginMsg.textContent = 'Отправка кода...';
            const sent = await sendCodeToEmail(user.email, code);
            if (sent) {
                loginForm.classList.add('hidden');
                loginCodeForm.classList.remove('hidden');
                loginMsg.textContent = '';
                loginCodeInput.value = '';
                loginCodeMsg.textContent = `Код отправлен на ${user.email}`;
            } else {
                loginMsg.textContent = 'Ошибка отправки кода. Попробуйте позже.';
            }
        });

        // Подтверждение кода при входе
        verifyLoginCodeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const entered = loginCodeInput.value.trim();
            if (!entered) {
                loginCodeMsg.textContent = 'Введите код';
                return;
            }
            if (!loginPending) {
                loginCodeMsg.textContent = 'Ошибка: нет ожидающего входа';
                return;
            }
            if (entered === loginPending.code) {
                alert('Доступ разрешён, господин. Добро пожаловать.');
                // Возврат к форме входа
                loginCodeForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
                loginUsername.value = '';
                loginPassword.value = '';
                loginCodeMsg.textContent = '';
                loginPending = null;
            } else {
                loginCodeMsg.textContent = 'Неверный код';
            }
        });

        // Назад из формы кода входа
        backToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            loginCodeForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            loginCodeMsg.textContent = '';
            loginPending = null;
        });

        // Для удобства добавим тестового пользователя (можно удалить)
        users['test'] = { email: 'test@example.com', password: '123' };
        console.log('Тестовый пользователь: test / 123');
    </script>
</body>
</html>